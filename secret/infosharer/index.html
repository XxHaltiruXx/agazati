<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <meta name="description" content="Itt tudsz inf√≥t osztani." />
<meta name="viewport" content="width=device-width, initial-scale=1" />
    <script>(function(){var basePath="/";if(location.pathname.indexOf("/agazati/")===0){basePath="/agazati/";}var base=document.createElement("base");base.href=basePath;document.head.appendChild(base);})();</script><link  href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"  rel="stylesheet"  integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"  crossorigin="anonymous"/>
    <script  src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"  integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"  crossorigin="anonymous"></script>
    <link  rel="shortcut icon"  href="assets/images/agazati.ico"  type="image/x-icon"/>
  <link rel="stylesheet" href="assets/css/base.css">
  <link rel="stylesheet" href="assets/css/main.css">
  <link rel="stylesheet" href="assets/css/nav.css" />
  <link rel="stylesheet" href="assets/css/utilities.css" />
  <link rel="stylesheet" href="assets/css/footer.css" />
  <link rel="stylesheet" href="assets/css/infosharer.css">
  <title>Infosharer</title>
</head>
<body>
  <header>
    <nav class="navbar navbar-expand">
      <div class="container-fluid align-items-center">
        <span onclick="toggleNav()" class="sidebargomb">&#9776;</span>
        <div class="navbar-nav">
          <a class="nav-link" href="./">f≈ëoldal</a>
          <a class="nav-link" href="html/">html</a>
          <a class="nav-link" href="css/">css</a>
          <a class="nav-link" href="python/">python</a>
          <a class="nav-link" href="network/">h√°l√≥zat</a>
          <a class="nav-link" href="math/">matek</a>
        </div>
      </div>
    </nav>
  </header>
  <div id="mySidenav" class="sidenav">
    <div>
      <input type="text" id="searchNav" placeholder="üîçKeres√©s...">
      <a href="#html">HTML alapok</a>
      <a href="#css">CSS alapok</a>
      <a href="#boxmodel">Box modell</a>
      <a href="#positioning">Pozicion√°l√°s</a>
      <a href="#flexbox">Flexbox</a>
      <a href="#grid">CSS Grid</a>
      <a href="#responsive">Respons√≠v diz√°jn</a>
      <a href="#animations">CSS anim√°ci√≥k</a>
      <a href="#accessibility">Hozz√°f√©rhet≈ës√©g</a>
      <a href="python.html#python">Python alapok</a>
      <a href="network.html#szamrendszer">Sz√°mrendszerek</a>
      <a href="network.html#halozat">Cisco parancsok</a>
    </div>
  </div>
  <h2 class="cim subsite">Infosharer</h2>
  <div class="meta">Az oldal alapb√≥l csak olvashat√≥. Kattints az <strong>√çr√°s enged√©lyez√©se</strong>-re, add meg a jelsz√≥t, majd szerkeszd √©s mentsd.</div>
  <textarea id="shared" readonly placeholder="Bet√∂lt√©s..."></textarea>
  
  <div class="controls">
    <div class="left">
      <div class="mainBtns">
        <button id="openPw" class="secondary">√çr√°s enged√©lyez√©se</button>
        <button id="copyBtn" class="ghost">M√°sol√°s</button>
      </div>
      <div class="authBtns" id="authBtns" style="display:none">
        <button id="saveBtn" class="ghost" disabled>Ment√©s</button>
        <button id="copyBtn2" class="ghost">M√°sol√°s</button>
        <button id="logoutBtn" class="ghost">Kijelentkez√©s</button>
      </div>
    </div>
    <div class="right">
      <div class="status" id="status">Kapcsolat: -</div>
    </div>
  </div>

  <!-- F√°jl felt√∂lt√©s √©s slotok -->
  <div class="container mt-5" style="max-width: 1200px;">
    <div class="row mb-4">
      <div class="col-12">
        <h3 class="text-center mb-4" style="color: var(--text);">F√°jl Slots</h3>
        <div class="meta mb-4">
          Mindenki let√∂ltheti a f√°jlokat. Csak bejelentkezett felhaszn√°l√≥k t√∂lthetnek fel √©s t√∂r√∂lhetnek f√°jlokat.
          <br><span id="filesStatus" style="color: var(--muted); font-size: 0.9em;">F√°jlok bet√∂lt√©se...</span>
        </div>
      </div>
    </div>

    <!-- F√°jl slotok grid -->
    <div class="row" id="slotContainer">
      <!-- Slotok itt j√∂nnek l√©tre dinamikusan -->
    </div>

    <!-- F√°jl felt√∂lt√©s modal -->
    <div class="modal fade" id="uploadModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content" style="background: var(--bg-mid); border: 1px solid var(--accent);">
          <div class="modal-header" style="border-bottom: 1px solid var(--accent);">
            <h5 class="modal-title" style="color: var(--text);">F√°jl felt√∂lt√©s - <span id="modalSlotTitle">Slot 1</span></h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" style="filter: invert(1);"></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label for="fileUploadInput" class="form-label" style="color: var(--text);">V√°lassz f√°jlt</label>
              <input class="form-control" type="file" id="fileUploadInput" style="
                background: #16162a;
                color: var(--text);
                border: 1px solid var(--accent);
              ">
              <div class="form-text" style="color: var(--muted);">
                Maxim√°lis m√©ret: 50 MB
              </div>
            </div>
            <div id="fileInfo" style="display: none; padding: 10px; background: rgba(127, 90, 240, 0.1); border-radius: 6px; margin-bottom: 15px;">
              <div style="color: var(--text);"><strong>Kiv√°lasztott f√°jl:</strong> <span id="selectedFileName"></span></div>
              <div style="color: var(--muted);" id="selectedFileSize"></div>
            </div>
            <div id="uploadProgress" style="display: none;">
              <div class="progress" style="height: 8px; background: #16162a; border-radius: 4px; overflow: hidden;">
                <div id="uploadProgressBar" class="progress-bar" role="progressbar" style="background: var(--accent); width: 0%;"></div>
              </div>
              <div id="uploadProgressText" class="text-center mt-2" style="color: var(--muted);">Felt√∂lt√©s...</div>
            </div>
          </div>
          <div class="modal-footer" style="border-top: 1px solid var(--accent);">
            <button type="button" class="btn ghost" data-bs-dismiss="modal">M√©gse</button>
            <button type="button" class="btn secondary" id="confirmUpload">Felt√∂lt√©s</button>
          </div>
        </div>
      </div>
    </div>

    <!-- F√°jl t√∂rl√©s meger≈ës√≠t√©s modal -->
    <div class="modal fade" id="deleteModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content" style="background: var(--bg-mid); border: 1px solid var(--accent);">
          <div class="modal-header" style="border-bottom: 1px solid var(--accent);">
            <h5 class="modal-title" style="color: var(--text);">F√°jl t√∂rl√©se</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" style="filter: invert(1);"></button>
          </div>
          <div class="modal-body">
            <p style="color: var(--text);">Biztosan t√∂r√∂lni szeretn√©d ezt a f√°jlt?</p>
            <p id="deleteFileName" style="color: var(--accent-light); font-weight: bold; word-break: break-all;"></p>
          </div>
          <div class="modal-footer" style="border-top: 1px solid var(--accent);">
            <button type="button" class="btn ghost" data-bs-dismiss="modal">M√©gse</button>
            <button type="button" class="btn" id="confirmDelete" style="background: var(--error); color: white;">T√∂rl√©s</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="pwModal" style="display:none" aria-hidden="true" role="dialog" tabindex="-1">
    <div id="pwBox" role="document" tabindex="0">
      <h2 style="margin:0 0 8px">√çr√°s jelsz√≥val</h2>
      <div style="font-size:0.95rem;color:var(--muted);margin-bottom:10px">√çrd be a jelsz√≥t, hogy szerkeszthess.</div>
      <div class="password-container">
        <div class="password-inner">
          <input id="pwInput" type="password" autocomplete="off" placeholder="Jelsz√≥" />
          <span class="toggle-password" id="togglePassword" role="button" tabindex="0"></span>
        </div>
      </div>
      <div class="remember-container">
        <input type="checkbox" id="rememberMe">
        <label for="rememberMe">Eml√©kezz r√°m</label>
      </div>
      <div style="display:flex;gap:8px;justify-content:center;margin-top:12px">
        <button id="pwCancel" class="ghost">M√©gse</button>
        <button id="pwOk">Bejelentkez√©s</button>
      </div>
      <div class="error" id="pwNote">Helytelen jelsz√≥</div>
      <div class="info" id="pwInfo">Sikeres ‚Äî √≠r√°s enged√©lyezve</div>
      <small class="hint">Sz√≥k√∂z a beviteln√©l: a jelsz√≥ trim-elve lesz (v√©letlen sz√≥k√∂z√∂k elt√°vol√≠t√°sa).</small>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <script type="module">
const SUPABASE_URL = 'https://ccpuoqrbmldunshaxpes.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNjcHVvcXJibWxkdW5zaGF4cGVzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI1MTE2MDUsImV4cCI6MjA3ODA4NzYwNX0.QpVCmzF96Fp5hdgFyR0VkT9RV6qKiLkA8Yv_LArSk5I';
const PASSWORD_HASH = '248e464b6e49676c615430dbfb831787d3d7c78e52bd2cb2461608991f7204f6';
const TABLE = 'infosharer';
const ID = 1;
const BUCKET_NAME = 'infosharer-uploads';
const MAX_SLOTS = 4;
const MAX_FILE_SIZE_BYTES = 50 * 1024 * 1024; // 50 MB
const REMEMBER_ME_KEY = 'infosharer_remember_token';
const SITEWIDE_LOGIN_KEY = '__agazati_login_state';
const SITEWIDE_LOGIN_EXPIRY = '__agazati_login_expiry';
const REMEMBER_DURATION = 365 * 24 * 60 * 60 * 1000;
const SITEWIDE_LOGIN_DURATION = 24 * 60 * 60 * 1000; // 24 √≥ra

import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';
const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

// Elemek
const ta = document.getElementById('shared');
const openPw = document.getElementById('openPw');
const pwModal = document.getElementById('pwModal');
const pwInput = document.getElementById('pwInput');
const pwOk = document.getElementById('pwOk');
const pwCancel = document.getElementById('pwCancel');
const pwNote = document.getElementById('pwNote');
const pwInfo = document.getElementById('pwInfo');
const saveBtn = document.getElementById('saveBtn');
const statusEl = document.getElementById('status');
const copyBtn = document.getElementById('copyBtn');
const copyBtn2 = document.getElementById('copyBtn2');
const authBtns = document.getElementById('authBtns');
const mainBtns = document.querySelector('.mainBtns');
const togglePassword = document.getElementById('togglePassword');
const rememberMe = document.getElementById('rememberMe');
const logoutBtn = document.getElementById('logoutBtn');

// F√°jlkezel√©s elemei
const slotContainer = document.getElementById('slotContainer');
const filesStatus = document.getElementById('filesStatus');
const uploadModal = new bootstrap.Modal(document.getElementById('uploadModal'));
const deleteModal = new bootstrap.Modal(document.getElementById('deleteModal'));
const fileUploadInput = document.getElementById('fileUploadInput');
const modalSlotTitle = document.getElementById('modalSlotTitle');
const selectedFileName = document.getElementById('selectedFileName');
const selectedFileSize = document.getElementById('selectedFileSize');
const fileInfo = document.getElementById('fileInfo');
const uploadProgress = document.getElementById('uploadProgress');
const uploadProgressBar = document.getElementById('uploadProgressBar');
const uploadProgressText = document.getElementById('uploadProgressText');
const confirmUpload = document.getElementById('confirmUpload');
const deleteFileName = document.getElementById('deleteFileName');
const confirmDelete = document.getElementById('confirmDelete');

let canEdit = false;
let channelRef = null;
let currentSlot = null;
let fileToDelete = null;
let fileChannel = null;

// F√°jlok √©s slotok lek√©pez√©se
const slotMappings = {
  1: null,
  2: null,
  3: null,
  4: null
};

// Sz√∂veg bet√∂lt√©se
async function load(){
  try{
    const { data, error } = await supabase.from(TABLE).select('content').eq('id', ID).limit(1).single();
    if (error || !data) return;
    if (canEdit && document.activeElement === ta) return;
    const newContent = data.content || '';
    if (newContent !== ta.value) ta.value = newContent;
  }catch(err){
    console.error('Load error', err);
  }
}

// Sz√∂veg ment√©se
async function upsert(text){
  try{
    await supabase.from(TABLE).upsert({ id: ID, content: text }, { onConflict: 'id' });
  }catch(err){
    console.error('Upsert error', err);
    alert('Ment√©s hiba (n√©zd a konzolt)');
  }
}

// Kapcsolat √°llapota
function setStatusFromState(state){
  let s = (state || '').toString().toLowerCase();
  if (s === 'closed' || s === 'megszakadt' || s === 'closedconnection') {
    s = 'megszakadt';
    statusEl.dataset.state = s;
    statusEl.textContent = 'Kapcsolat: megszakadt';
  } else {
    s = '√©l≈ë';
    statusEl.dataset.state = s;
    statusEl.textContent = 'Kapcsolat: √©l≈ë';
  }
}

function setFilesStatus(state, message = '') {
  if (!filesStatus) return;
  
  let text = '';
  let color = '';
  
  switch(state) {
    case 'loading':
      text = 'F√°jlok bet√∂lt√©se...';
      color = 'var(--muted)';
      break;
    case 'success':
      text = message || 'F√°jlok bet√∂ltve';
      color = 'var(--success)';
      break;
    case 'error':
      text = message || 'Hiba a f√°jlok bet√∂lt√©sekor';
      color = 'var(--error)';
      break;
    case 'updated':
      text = message || 'F√°jlok friss√≠tve';
      color = 'var(--accent-light)';
      break;
    default:
      text = 'F√°jlok k√©szen';
      color = 'var(--muted)';
  }
  
  filesStatus.textContent = text;
  filesStatus.style.color = color;
}

// Real-time el≈ëfizet√©s a sz√∂veghez
function subscribeRealtime(){
  try{
    const channelName = 'public:' + TABLE;
    channelRef = supabase.channel(channelName).on('postgres_changes', { event: '*', schema: 'public', table: TABLE, filter: `id=eq.${ID}` }, payload=>{
      const row = payload?.new;
      if (row){
        if (!(canEdit && document.activeElement === ta)){
          ta.value = row.content || '';
        }
      }
    });
    const sub = channelRef.subscribe((statusOrObj)=>{
      try{
        if (!statusOrObj) {
          setStatusFromState('ismeretlen');
        } else if (typeof statusOrObj === 'string'){
          const normalized = statusOrObj === 'SUBSCRIBED' ? '√©l≈ë' : (statusOrObj === 'CLOSED' ? 'megszakadt' : statusOrObj);
          setStatusFromState(normalized);
        } else if (typeof statusOrObj === 'object'){
          const s = statusOrObj.status || statusOrObj;
          const normalized = (s === 'SUBSCRIBED') ? '√©l≈ë' : ((s === 'CLOSED') ? 'megszakadt' : s);
          setStatusFromState(normalized);
        } else {
          setStatusFromState(String(statusOrObj));
        }
      }catch(e){
        setStatusFromState('megszakadt');
      }
    });
    sub.on('error', (err)=>{
      setStatusFromState('megszakadt');
    });
  }catch(err){
    setStatusFromState('megszakadt');
  }
}

// Real-time el≈ëfizet√©s a f√°jlokhoz (polling)
function subscribeFileRealtime() {
  // Polling minden 3 m√°sodpercben a f√°jlok friss√≠t√©s√©hez
  setInterval(async () => {
    try {
      await updateSlots(true); // true = csendes friss√≠t√©s (nem jelen√≠t √∫j √ºzenetet)
    } catch (err) {
      console.error('F√°jl friss√≠t√©si hiba:', err);
    }
  }, 3000);
}

// F√°jl ikon alapj√°n a kiterjeszt√©s alapj√°n
function getFileIcon(filename) {
  if (!filename) return 'üìÅ';
  const ext = filename.split('.').pop().toLowerCase();
  const icons = {
    'pdf': 'üìï',
    'doc': 'üìò', 'docx': 'üìò',
    'xls': 'üìó', 'xlsx': 'üìó',
    'ppt': 'üìì', 'pptx': 'üìì',
    'txt': 'üìÑ',
    'zip': 'üì¶', 'rar': 'üì¶', '7z': 'üì¶', 'tar': 'üì¶', 'gz': 'üì¶',
    'jpg': 'üñºÔ∏è', 'jpeg': 'üñºÔ∏è', 'png': 'üñºÔ∏è', 'gif': 'üñºÔ∏è', 'bmp': 'üñºÔ∏è', 'svg': 'üñºÔ∏è', 'webp': 'üñºÔ∏è',
    'mp3': 'üéµ', 'wav': 'üéµ', 'ogg': 'üéµ', 'flac': 'üéµ',
    'mp4': 'üé¨', 'avi': 'üé¨', 'mov': 'üé¨', 'mkv': 'üé¨', 'wmv': 'üé¨', 'flv': 'üé¨',
    'exe': '‚öôÔ∏è',
    'html': 'üåê', 'htm': 'üåê',
    'css': 'üé®',
    'js': 'üìú',
    'py': 'üêç',
    'java': '‚òï',
    'cpp': '‚ö°', 'c': '‚ö°',
    'json': 'üìã',
    'xml': 'üìÑ',
    'sql': 'üóÑÔ∏è',
    'psd': 'üé®',
    'ai': '‚úèÔ∏è',
    'sketch': '‚úèÔ∏è',
    'md': 'üìù',
    'csv': 'üìä',
    'rtf': 'üìÑ',
    'dmg': 'üíø',
    'iso': 'üíø'
  };
  return icons[ext] || 'üìÅ';
}

// F√°jlm√©ret form√°z√°sa
function formatFileSize(bytes) {
  if (bytes === 0) return '0 B';
  
  const k = 1024;
  const sizes = ['B', 'KB', 'MB', 'GB', 'TB'];
  const i = Math.floor(Math.log(bytes) / Math.log(k));
  
  return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}

// Slot-hez tartoz√≥ f√°jl let√∂lt√©se - JAV√çTOTT VERZI√ì
async function downloadFile(fileName, originalName) {
  try {
    // Blob let√∂lt√©s - ez mindig let√∂lti, nem nyitja meg
    const { data, error } = await supabase.storage
      .from(BUCKET_NAME)
      .download(fileName);
    
    if (error) {
      console.error('Let√∂lt√©si hiba:', error);
      throw error;
    }
    
    // Blob URL l√©trehoz√°sa
    const url = URL.createObjectURL(data);
    
    // L√©trehozunk egy l√°thatatlan linket
    const a = document.createElement('a');
    a.href = url;
    a.download = originalName || fileName.replace(/^slot\d+_/, ''); // Elt√°vol√≠tjuk a slot el≈ëtagot
    a.style.display = 'none';
    document.body.appendChild(a);
    
    // Kattint√°s a linkre
    a.click();
    
    // Takar√≠t√°s
    setTimeout(() => {
      URL.revokeObjectURL(url);
      document.body.removeChild(a);
    }, 100);
    
    // Sikeres let√∂lt√©s visszajelz√©s
    setFilesStatus('success', 'F√°jl let√∂lt√©se elkezd≈ëd√∂tt');
    
  } catch (err) {
    console.error('Blob let√∂lt√©si hiba, alternat√≠v m√≥dszer:', err);
    
    // Alternat√≠v m√≥dszer: signed URL let√∂lt√©se
    try {
      const { data: signedUrlData, error: signedError } = await supabase.storage
        .from(BUCKET_NAME)
        .createSignedUrl(fileName, 60); // 60 m√°sodpercig √©rv√©nyes
      
      if (signedError) throw signedError;
      
      // L√©trehozunk egy l√°thatatlan linket a signed URL-lel
      const a = document.createElement('a');
      a.href = signedUrlData.signedUrl;
      a.download = originalName || fileName.replace(/^slot\d+_/, '');
      a.style.display = 'none';
      document.body.appendChild(a);
      a.click();
      
      setTimeout(() => {
        document.body.removeChild(a);
      }, 100);
      
    } catch (signedErr) {
      console.error('Signed URL hiba:', signedErr);
      
      // Visszaes√©s a nyilv√°nos URL-re
      const { data: publicUrlData } = supabase.storage.from(BUCKET_NAME).getPublicUrl(fileName);
      
      // Pr√≥b√°ljuk meg a let√∂lt√©st a download attrib√∫tummal
      const a = document.createElement('a');
      a.href = publicUrlData.publicUrl;
      a.download = originalName || fileName.replace(/^slot\d+_/, '');
      a.style.display = 'none';
      document.body.appendChild(a);
      a.click();
      
      setTimeout(() => {
        document.body.removeChild(a);
      }, 100);
    }
  }
}

// Slotok l√©trehoz√°sa √©s friss√≠t√©se
async function updateSlots(silent = false) {
  try {
    if (!silent) {
      setFilesStatus('loading');
    }
    
    const { data, error } = await supabase.storage.from(BUCKET_NAME).list('');
    
    if (error) {
      console.error('F√°jllista hiba:', error);
      setFilesStatus('error', 'Hiba a f√°jlok bet√∂lt√©sekor');
      return;
    }
    
    // Resetelj√ºk a slot lek√©pez√©seket
    Object.keys(slotMappings).forEach(key => {
      slotMappings[key] = null;
    });
    
    // F√°jlok hozz√°rendel√©se a slotokhoz a f√°jln√©v alapj√°n
    if (data && data.length > 0) {
      data.forEach(file => {
        // Megn√©zz√ºk, hogy a f√°jln√©v tartalmaz-e slot sz√°mot
        const match = file.name.match(/slot(\d+)_(.+)/);
        if (match) {
          const slotNum = parseInt(match[1]);
          const originalName = match[2];
          
          if (slotNum >= 1 && slotNum <= MAX_SLOTS) {
            slotMappings[slotNum] = {
              fileName: file.name,
              originalName: originalName,
              metadata: file.metadata,
              created_at: file.created_at
            };
          }
        }
      });
    }
    
    slotContainer.innerHTML = '';
    
    // 4 slot l√©trehoz√°sa
    for (let i = 1; i <= MAX_SLOTS; i++) {
      const fileData = slotMappings[i];
      const isFilled = fileData ? true : false;
      
      const col = document.createElement('div');
      col.className = 'col-md-3 col-sm-6 mb-4';
      
      const card = document.createElement('div');
      card.className = 'card h-100';
      card.style.cssText = `
        background: var(--bg-mid);
        border: 2px solid ${isFilled ? 'var(--accent)' : 'var(--muted)'};
        border-radius: 12px;
        overflow: hidden;
        transition: all 0.3s ease;
      `;
      
      if (isFilled) {
        card.style.boxShadow = '0 4px 15px rgba(127, 90, 240, 0.2)';
      }
      
      const cardBody = document.createElement('div');
      cardBody.className = 'card-body d-flex flex-column';
      
      // F√°jl ikon
      const iconContainer = document.createElement('div');
      iconContainer.className = 'text-center mb-3';
      iconContainer.style.cssText = 'font-size: 3.5rem;';
      
      const fileIcon = document.createElement('div');
      fileIcon.textContent = getFileIcon(fileData?.originalName || '');
      fileIcon.style.cssText = 'display: inline-block;';
      iconContainer.appendChild(fileIcon);
      
      // Slot c√≠m
      const slotTitle = document.createElement('h5');
      slotTitle.className = 'card-title text-center mb-3';
      slotTitle.style.cssText = 'color: var(--text); font-weight: bold;';
      slotTitle.textContent = `Slot ${i}`;
      
      // F√°jl inform√°ci√≥k
      const fileInfoContainer = document.createElement('div');
      fileInfoContainer.className = 'mb-3 flex-grow-1';
      
      if (isFilled) {
        const fileName = document.createElement('div');
        fileName.className = 'text-center mb-2';
        fileName.style.cssText = 'color: var(--accent-light); font-weight: 500; word-break: break-all;';
        const displayName = fileData.originalName.length > 25 ? 
          fileData.originalName.substring(0, 25) + '...' : 
          fileData.originalName;
        fileName.textContent = displayName;
        fileName.title = fileData.originalName;
        
        const fileExt = document.createElement('div');
        fileExt.className = 'text-center mb-1';
        fileExt.style.cssText = 'color: var(--muted); font-size: 0.9rem;';
        const ext = fileData.originalName.split('.').pop().toUpperCase();
        fileExt.textContent = `.${ext}`;
        
        const fileSize = document.createElement('div');
        fileSize.className = 'text-center';
        fileSize.style.cssText = 'color: var(--muted); font-size: 0.85rem;';
        const sizeInBytes = fileData.metadata?.size || 0;
        fileSize.textContent = formatFileSize(sizeInBytes);
        
        const fileDate = document.createElement('div');
        fileDate.className = 'text-center mt-1';
        fileDate.style.cssText = 'color: #666; font-size: 0.8rem;';
        const uploadDate = fileData.created_at ? new Date(fileData.created_at) : new Date();
        fileDate.textContent = uploadDate.toLocaleDateString('hu-HU');
        
        fileInfoContainer.appendChild(fileName);
        fileInfoContainer.appendChild(fileExt);
        fileInfoContainer.appendChild(fileSize);
        fileInfoContainer.appendChild(fileDate);
      } else {
        const emptyText = document.createElement('div');
        emptyText.className = 'text-center';
        emptyText.style.cssText = 'color: var(--muted); font-style: italic; padding: 20px 0;';
        emptyText.textContent = '√úres slot';
        fileInfoContainer.appendChild(emptyText);
      }
      
      // Gombok
      const buttonContainer = document.createElement('div');
      buttonContainer.className = 'd-grid gap-2';
      
      // Let√∂lt√©s gomb (mindig l√°that√≥, ha van f√°jl)
      if (isFilled) {
        const downloadBtn = document.createElement('button');
        downloadBtn.className = 'btn';
        downloadBtn.style.cssText = `
          background: var(--accent);
          color: white;
          border: none;
          font-weight: 500;
        `;
        downloadBtn.textContent = 'Let√∂lt√©s';
        downloadBtn.onclick = () => {
          downloadFile(fileData.fileName, fileData.originalName);
        };
        buttonContainer.appendChild(downloadBtn);
      }
      
      // Felt√∂lt√©s/T√∂rl√©s gombok (csak bejelentkezett felhaszn√°l√≥knak)
      if (canEdit) {
        if (isFilled) {
          // T√∂rl√©s gomb
          const deleteBtn = document.createElement('button');
          deleteBtn.className = 'btn mt-2';
          deleteBtn.style.cssText = `
            background: transparent;
            color: var(--error);
            border: 1px solid var(--error);
            font-weight: 500;
          `;
          deleteBtn.textContent = 'T√∂rl√©s';
          deleteBtn.onclick = () => {
            currentSlot = i;
            fileToDelete = fileData.fileName;
            deleteFileName.textContent = fileData.originalName;
            deleteModal.show();
          };
          buttonContainer.appendChild(deleteBtn);
          
          // Csere gomb
          const replaceBtn = document.createElement('button');
          replaceBtn.className = 'btn mt-2';
          replaceBtn.style.cssText = `
            background: transparent;
            color: var(--muted);
            border: 1px solid var(--muted);
            font-weight: 500;
          `;
          replaceBtn.textContent = 'Csere';
          replaceBtn.onclick = () => openUploadModal(i, fileData.originalName);
          buttonContainer.appendChild(replaceBtn);
        } else {
          // Felt√∂lt√©s gomb (√ºres slot)
          const uploadBtn = document.createElement('button');
          uploadBtn.className = 'btn';
          uploadBtn.style.cssText = `
            background: transparent;
            color: var(--accent-light);
            border: 1px solid var(--accent-light);
            font-weight: 500;
          `;
          uploadBtn.textContent = 'F√°jl felt√∂lt√©s';
          uploadBtn.onclick = () => openUploadModal(i);
          buttonContainer.appendChild(uploadBtn);
        }
      }
      
      // √ñssze√°ll√≠t√°s
      cardBody.appendChild(iconContainer);
      cardBody.appendChild(slotTitle);
      cardBody.appendChild(fileInfoContainer);
      cardBody.appendChild(buttonContainer);
      
      card.appendChild(cardBody);
      col.appendChild(card);
      slotContainer.appendChild(col);
    }
    
    if (!silent) {
      const filledSlots = Object.values(slotMappings).filter(Boolean).length;
      setFilesStatus('success', `${filledSlots}/${MAX_SLOTS} slot haszn√°lva`);
      
      // 3 m√°sodperc m√∫lva vissza√°ll√≠tjuk az alap√°llapotba
      setTimeout(() => {
        setFilesStatus('success', '');
      }, 3000);
    }
    
  } catch (err) {
    console.error('Slot friss√≠t√©si hiba:', err);
    if (!silent) {
      setFilesStatus('error', 'Hiba a slotok friss√≠t√©sekor');
    }
  }
}

// Felt√∂lt√©s modal megnyit√°sa
function openUploadModal(slotNumber, existingFileName = null) {
  currentSlot = slotNumber;
  modalSlotTitle.textContent = `Slot ${slotNumber}`;
  fileUploadInput.value = '';
  fileInfo.style.display = 'none';
  uploadProgress.style.display = 'none';
  uploadProgressBar.style.width = '0%';
  uploadProgressText.textContent = 'Felt√∂lt√©s...';
  
  // Ha van megl√©v≈ë f√°jl, t√°j√©koztatjuk a felhaszn√°l√≥t
  if (existingFileName) {
    selectedFileName.textContent = `A megl√©v≈ë f√°jl (${existingFileName}) fel√ºl lesz √≠rva.`;
    selectedFileSize.textContent = '';
    fileInfo.style.display = 'block';
  }
  
  uploadModal.show();
}

// F√°jl kiv√°laszt√°s esem√©nykezel≈ë
fileUploadInput.addEventListener('change', function() {
  const file = this.files[0];
  if (!file) {
    fileInfo.style.display = 'none';
    return;
  }
  
  // Ellen≈ërizz√ºk a f√°jlm√©retet
  if (file.size > MAX_FILE_SIZE_BYTES) {
    alert(`A f√°jl t√∫l nagy! Maximum ${MAX_FILE_SIZE_BYTES / (1024 * 1024)} MB lehet.`);
    this.value = '';
    fileInfo.style.display = 'none';
    return;
  }
  
  // Megjelen√≠tj√ºk a f√°jl inform√°ci√≥t
  selectedFileName.textContent = file.name;
  selectedFileSize.textContent = `M√©ret: ${formatFileSize(file.size)}`;
  fileInfo.style.display = 'block';
});

// F√°jl felt√∂lt√©s
confirmUpload.addEventListener('click', async function() {
  const file = fileUploadInput.files[0];
  if (!file) {
    alert('V√°lassz ki egy f√°jlt!');
    return;
  }
  
  // Ellen≈ërizz√ºk a f√°jlm√©retet
  if (file.size > MAX_FILE_SIZE_BYTES) {
    alert(`A f√°jl t√∫l nagy! Maximum ${MAX_FILE_SIZE_BYTES / (1024 * 1024)} MB lehet.`);
    return;
  }
  
  // Felt√∂lt√©s ind√≠t√°sa
  uploadProgress.style.display = 'block';
  uploadProgressBar.style.width = '30%';
  this.disabled = true;
  
  try {
    // Egyedi f√°jln√©v gener√°l√°sa: slot{slotNumber}_{eredetiF√°jln√©v}
    const slotFileName = `slot${currentSlot}_${file.name}`;
    
    // Ellen≈ërizz√ºk, hogy van-e m√°r f√°jl ebben a slotban
    const existingFileData = slotMappings[currentSlot];
    
    uploadProgressBar.style.width = '60%';
    
    // Ha van megl√©v≈ë f√°jl ebben a slotban, t√∂r√∂lj√ºk
    if (existingFileData && existingFileData.fileName) {
      await supabase.storage.from(BUCKET_NAME).remove([existingFileData.fileName]);
    }
    
    // Felt√∂lt√©s
    const { data, error } = await supabase.storage
      .from(BUCKET_NAME)
      .upload(slotFileName, file, {
        cacheControl: '3600',
        upsert: true
      });
    
    uploadProgressBar.style.width = '90%';
    
    if (error) {
      console.error('Felt√∂lt√©si hiba:', error);
      uploadProgressText.textContent = 'Hiba a felt√∂lt√©s sor√°n';
      uploadProgressBar.style.background = 'var(--error)';
      throw error;
    }
    
    // Sikeres felt√∂lt√©s
    uploadProgressText.textContent = 'Felt√∂lt√©s sikeres!';
    uploadProgressBar.style.width = '100%';
    
    setTimeout(() => {
      uploadModal.hide();
      updateSlots();
      this.disabled = false;
      fileUploadInput.value = '';
    }, 1000);
    
  } catch (err) {
    console.error('Felt√∂lt√©si hiba:', err);
    alert('Felt√∂lt√©s sikertelen: ' + (err.message || 'Ismeretlen hiba'));
    this.disabled = false;
  }
});

// F√°jl t√∂rl√©se
confirmDelete.addEventListener('click', async function() {
  if (!fileToDelete) return;
  
  try {
    const { error } = await supabase.storage.from(BUCKET_NAME).remove([fileToDelete]);
    
    if (error) {
      console.error('T√∂rl√©si hiba:', error);
      alert('Hiba a t√∂rl√©s sor√°n: ' + error.message);
    } else {
      // Sikeres t√∂rl√©s
      updateSlots();
    }
  } catch (err) {
    console.error('T√∂rl√©si hiba:', err);
    alert('Hiba a t√∂rl√©s sor√°n');
  } finally {
    deleteModal.hide();
    fileToDelete = null;
    currentSlot = null;
  }
});

// BEJELENTKEZ√âSI FUNKCI√ìK

// Site-wide bejelentkez√©s
function setSitewideLoginState() {
  try {
    const expiry = Date.now() + SITEWIDE_LOGIN_DURATION;
    localStorage.setItem(SITEWIDE_LOGIN_KEY, 'logged_in');
    localStorage.setItem(SITEWIDE_LOGIN_EXPIRY, expiry.toString());
    
    if (window.setLoginState) {
      window.setLoginState();
    }
  } catch (e) {
    console.error('Site-wide bejelentkez√©si √°llapot ment√©se sikertelen:', e);
  }
}

function checkSitewideLogin() {
  try {
    const loginState = localStorage.getItem(SITEWIDE_LOGIN_KEY);
    const loginExpiry = localStorage.getItem(SITEWIDE_LOGIN_EXPIRY);
    
    if (!loginState || !loginExpiry) return false;
    
    const now = Date.now();
    if (now > parseInt(loginExpiry)) {
      localStorage.removeItem(SITEWIDE_LOGIN_KEY);
      localStorage.removeItem(SITEWIDE_LOGIN_EXPIRY);
      return false;
    }
    
    return loginState === 'logged_in';
  } catch (e) {
    return false;
  }
}

function clearSitewideLogin() {
  try {
    localStorage.removeItem(SITEWIDE_LOGIN_KEY);
    localStorage.removeItem(SITEWIDE_LOGIN_EXPIRY);
    
    if (window.logoutFromNav) {
      window.logoutFromNav();
    }
  } catch (e) {
    console.error('Site-wide bejelentkez√©s t√∂rl√©se sikertelen:', e);
  }
}

// Remember me token kezel√©se
function setRememberToken() {
  const token = {
    value: PASSWORD_HASH,
    expires: Date.now() + REMEMBER_DURATION
  };
  localStorage.setItem(REMEMBER_ME_KEY, JSON.stringify(token));
}

function checkRememberMe() {
  const stored = localStorage.getItem(REMEMBER_ME_KEY);
  if (!stored) return false;
  try {
    const token = JSON.parse(stored);
    if (token.value === PASSWORD_HASH && token.expires > Date.now()) {
      return true;
    }
  } catch (e) {
    console.error('Hib√°s remember token:', e);
  }
  localStorage.removeItem(REMEMBER_ME_KEY);
  return false;
}

// SHA-256 hash f√ºggv√©ny
async function sha256hex(str){
  const enc = new TextEncoder().encode(str);
  const digest = await crypto.subtle.digest('SHA-256', enc);
  return Array.from(new Uint8Array(digest)).map(b=>b.toString(16).padStart(2,'0')).join('');
}

// ESEM√âNYKEZEL≈êK BE√ÅLL√çT√ÅSA

document.addEventListener('DOMContentLoaded', () => {
  // Alap√©rtelmezett be√°ll√≠t√°sok
  pwModal.style.display = 'none';
  pwModal.setAttribute('aria-hidden', 'true');
  ta.readOnly = true;
  saveBtn.disabled = true;
  
  // Ellen≈ërizz√ºk a remember me √©s site-wide bejelentkez√©st
  if (checkRememberMe() || checkSitewideLogin()) {
    canEdit = true;
    ta.readOnly = false;
    saveBtn.disabled = false;
    mainBtns.style.display = 'none';
    authBtns.style.display = 'flex';
  }
  
  // Slotok bet√∂lt√©se
  updateSlots();
  
  // Realtime el≈ëfizet√©sek ind√≠t√°sa
  subscribeFileRealtime();
  
  // Jelsz√≥ modal esem√©nyek
  openPw.addEventListener('click', () => {
    pwNote.style.display = 'none';
    pwInfo.style.display = 'none';
    pwModal.style.display = 'flex';
    pwModal.setAttribute('aria-hidden', 'false');
    pwInput.value = '';
    pwInput.type = 'password';
    togglePassword.style.backgroundImage = 'url("assets/images/view.png")';
    setTimeout(() => pwInput.focus(), 50);
  });
  
  // Modal bez√°r√°s
  const closeModal = () => {
    pwModal.style.display = 'none';
    pwModal.setAttribute('aria-hidden', 'true');
    pwInput.value = '';
    pwNote.style.display = 'none';
    pwInput.type = 'password';
    togglePassword.style.backgroundImage = 'url("assets/images/view.png")';
    rememberMe.checked = false;
  };
  
  pwCancel.addEventListener('click', closeModal);
  
  // ESC billenty≈±
  pwModal.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      e.preventDefault();
      closeModal();
    }
  });
  
  // F√≥kusz kezel√©s
  pwModal.addEventListener('keydown', (e) => {
    if (e.key === 'Tab') {
      const focusableElements = pwBox.querySelectorAll('input, button, [tabindex="0"]');
      const firstElement = focusableElements[0];
      const lastElement = focusableElements[ocusableElements.length - 1];
      
      if (e.shiftKey) {
        if (document.activeElement === firstElement) {
          e.preventDefault();
          lastElement.focus();
        }
      } else {
        if (document.activeElement === lastElement) {
          e.preventDefault();
          firstElement.focus();
        }
      }
    }
  });
  
  pwModal.addEventListener('mousedown', (e) => {
    if (e.target === pwModal && e.button === 0) {
      e.preventDefault();
      pwCancel.click();
    }
  });
  
  pwInput.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') {
      e.preventDefault();
      pwOk.click();
    }
  });
  
  pwOk.addEventListener('click', async () => {
    const raw = pwInput.value || '';
    const attempt = raw.trim();
    pwNote.style.display = 'none';
    try {
      const h = await sha256hex(attempt);
      document.dispatchEvent(new CustomEvent('infosharer:pwAttempt', { detail: { hash: h, raw: attempt } }));
    } catch (err) {
      pwNote.textContent = 'Hiba a jelsz√≥ellen≈ërz√©sn√©l';
      pwNote.style.display = 'block';
    }
  });
  
  // Jelsz√≥ l√°that√≥s√°g v√°lt√°sa
  togglePassword.addEventListener('click', function() {
    const isPassword = pwInput.type === 'password';
    pwInput.type = isPassword ? 'text' : 'password';
    this.style.backgroundImage = isPassword ? 'url("assets/images/hide.png")' : 'url("assets/images/view.png")';
  });
  
  // Ment√©s gomb
  saveBtn.addEventListener('click', async () => {
    if (!canEdit) {
      alert('El≈ëbb enged√©lyezd az √≠r√°st jelsz√≥val.');
      return;
    }
    saveBtn.textContent = 'Ment√©s...';
    saveBtn.disabled = true;
    await upsert(ta.value);
    saveBtn.textContent = '‚úÖ Mentve';
    setTimeout(() => {
      saveBtn.textContent = 'Ment√©s';
      saveBtn.disabled = false;
    }, 900);
  });
  
  // M√°sol√°s gombok
  const handleCopy = async (button) => {
    try {
      await navigator.clipboard.writeText(ta.value);
      const old = button.textContent;
      button.textContent = '‚úÖ M√°solva';
      setTimeout(() => {
        button.textContent = old;
      }, 900);
    } catch (err) {
      alert('M√°sol√°s sikertelen');
    }
  };
  
  copyBtn.addEventListener('click', () => handleCopy(copyBtn));
  copyBtn2.addEventListener('click', () => handleCopy(copyBtn2));
  
  // Kijelentkez√©s
  logoutBtn.addEventListener('click', function() {
    localStorage.removeItem(REMEMBER_ME_KEY);
    clearSitewideLogin();
    
    canEdit = false;
    ta.readOnly = true;
    saveBtn.disabled = true;
    authBtns.style.display = 'none';
    mainBtns.style.display = 'flex';
    
    try {
      if (channelRef && typeof channelRef.unsubscribe === 'function') {
        channelRef.unsubscribe();
      }
    } catch (e) {
      console.warn('unsubscribe error', e);
    }
    channelRef = null;
    setStatusFromState('√©l≈ë');
    statusEl.textContent = 'Kapcsolat: -';
    
    // Slotok friss√≠t√©se (elt≈±nik a felt√∂lt√©s/t√∂rl√©s gomb)
    updateSlots();
  });
});

// Bejelentkez√©si esem√©nyek
document.addEventListener('infosharer:pwAttempt', (ev) => {
  try {
    const sentHash = (ev?.detail?.hash || '').toLowerCase();
    if (!PASSWORD_HASH || PASSWORD_HASH.length === 0 || PASSWORD_HASH === 'replace_with_sha256_hex_of_password') {
      document.dispatchEvent(new CustomEvent('infosharer:authFail', { detail: { message: 'A szerver nincs konfigur√°lva (PASSWORD_HASH hi√°nyzik).' } }));
      return;
    }
    if (sentHash === PASSWORD_HASH.toLowerCase()) {
      document.dispatchEvent(new CustomEvent('infosharer:authSuccess'));
      canEdit = true;
      saveBtn.disabled = false;
      setTimeout(() => ta.focus(), 50);
    } else {
      document.dispatchEvent(new CustomEvent('infosharer:authFail', { detail: { message: 'Helytelen jelsz√≥' } }));
    }
  } catch (err) {
    document.dispatchEvent(new CustomEvent('infosharer:authFail', { detail: { message: 'Hiba' } }));
  }
});

document.addEventListener('infosharer:authSuccess', () => {
  pwModal.style.display = 'none';
  pwModal.setAttribute('aria-hidden', 'true');
  pwInput.value = '';
  pwNote.style.display = 'none';
  pwInfo.style.display = 'block';
  setTimeout(() => pwInfo.style.display = 'none', 1200);
  ta.readOnly = false;
  mainBtns.style.display = 'none';
  authBtns.style.display = 'flex';
  
  // Bejelentkez√©si √°llapot be√°ll√≠t√°sa
  setSitewideLoginState();
  if (rememberMe.checked) {
    setRememberToken();
  }
  rememberMe.checked = false;
  
  // Slotok friss√≠t√©se (megjelennek a felt√∂lt√©s/t√∂rl√©s gombok)
  updateSlots();
});

document.addEventListener('infosharer:authFail', (e) => {
  pwNote.textContent = e?.detail?.message || 'Helytelen jelsz√≥';
  pwNote.style.display = 'block';
});

// Inicializ√°l√°s
(async function init() {
  await load();
  subscribeRealtime();
  const REFRESH_INTERVAL = 1000;
  setInterval(async () => {
    try {
      if (canEdit && document.activeElement === ta) return;
      await load();
      const t = new Date();
      const hh = t.getHours().toString().padStart(2, '0');
      const mm = t.getMinutes().toString().padStart(2, '0');
      const ss = t.getSeconds().toString().padStart(2, '0');
      const stamp = hh + ':' + mm + ':' + ss;
      const currentState = statusEl.dataset.state || 'ismeretlen';
      statusEl.textContent = 'Kapcsolat: friss√≠tve ' + stamp;
      if (currentState) {
        statusEl.dataset.state = currentState;
      }
    } catch (e) {
      console.error(e);
    }
  }, REFRESH_INTERVAL);
})();
  </script>
  
  <!-- St√≠lusok a slot k√°rty√°khoz -->
  <style>
    .card {
      transition: all 0.3s ease;
    }
    
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 25px rgba(127, 90, 240, 0.3) !important;
    }
    
    .btn {
      transition: all 0.2s ease;
      border-radius: 8px;
      padding: 0.5rem 1rem;
    }
    
    .btn:hover {
      transform: translateY(-2px);
    }
    
    .modal-content {
      border-radius: 12px;
    }
    
    .form-control {
      background: #16162a;
      color: var(--text);
      border: 1px solid var(--accent);
      border-radius: 8px;
      padding: 0.75rem;
    }
    
    .form-control:focus {
      background: #16162a;
      color: var(--text);
      border-color: var(--accent-light);
      box-shadow: 0 0 0 0.25rem rgba(127, 90, 240, 0.25);
    }
    
    .form-label {
      font-weight: 500;
      margin-bottom: 0.5rem;
    }
    
    .form-text {
      font-size: 0.875rem;
      margin-top: 0.25rem;
    }
    
    /* Responsive design */
    @media (max-width: 768px) {
      .col-md-3 {
        flex: 0 0 50%;
        max-width: 50%;
      }
    }
    
    @media (max-width: 576px) {
      .col-md-3, .col-sm-6 {
        flex: 0 0 100%;
        max-width: 100%;
      }
      
      .card-body {
        padding: 1.25rem;
      }
    }
  </style>
  
  <script src="assets/js/nav.js"></script>
  <script src="assets/js/footer.js"></script>
</body>
</html>
