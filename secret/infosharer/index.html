<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script>(function(){var basePath="/";if(location.pathname.indexOf("/agazati/")===0){basePath="/agazati/";}var base=document.createElement("base");base.href=basePath;document.head.appendChild(base);})();</script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous" />
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
  <link rel="shortcut icon" href="assets/images/py.ico" type="image/x-icon" />
  <link rel="stylesheet" href="assets/css/base.css">
  <link rel="stylesheet" href="assets/css/main.css">
  <link rel="stylesheet" href="assets/css/nav.css" />
  <link rel="stylesheet" href="assets/css/utilities.css" />
  <link rel="stylesheet" href="assets/css/footer.css" />
  <link rel="stylesheet" href="assets/css/infosharer.css">
  <title>Infosharer</title>
</head>
<script src="assets/js/nav.js"></script>
<body>
  <header>
    <nav class="navbar navbar-expand">
      <div class="container-fluid align-items-center">
        <span onclick="toggleNav()" class="sidebargomb">&#9776;</span>
        <div class="navbar-nav">
          <a class="nav-link" href="./">f≈ëoldal</a>
          <a class="nav-link" href="html/">html&css</a>
          <a class="nav-link" href="python/">python</a>
          <a class="nav-link" href="network/">h√°l√≥zat</a>
          <a class="nav-link" href="math/">matek</a>
        </div>
      </div>
    </nav>
  </header>
  <div id="mySidenav" class="sidenav">
    <div>
      <input type="text" id="searchNav" placeholder="üîçKeres√©s...">
      <a href="#html">HTML alapok</a>
      <a href="#css">CSS alapok</a>
      <a href="#boxmodel">Box modell</a>
      <a href="#positioning">Pozicion√°l√°s</a>
      <a href="#flexbox">Flexbox</a>
      <a href="#grid">CSS Grid</a>
      <a href="#responsive">Respons√≠v diz√°jn</a>
      <a href="#animations">CSS anim√°ci√≥k</a>
      <a href="#accessibility">Hozz√°f√©rhet≈ës√©g</a>
      <a href="python.html#python">Python alapok</a>
      <a href="network.html#szamrendszer">Sz√°mrendszerek</a>
      <a href="network.html#halozat">Cisco parancsok</a>
    </div>
  </div>
  <h2 class="cim subsite">Infosharer</h2>
  <div class="meta">Az oldal alapb√≥l csak olvashat√≥. Kattints az <strong>√çr√°s enged√©lyez√©se</strong>-re, add meg a jelsz√≥t, majd szerkeszd √©s mentsd.</div>
  <textarea id="shared" readonly placeholder="Bet√∂lt√©s..."></textarea>
  <div class="controls">
    <div class="left">
      <button id="openPw" class="secondary">√çr√°s enged√©lyez√©se</button>
      <div class="authBtns" id="authBtns" style="display:none">
        <button id="saveBtn" class="ghost" disabled>Ment√©s</button>
        <button id="copyBtn" class="ghost">M√°sol√°s</button>
        <button id="logoutBtn" class="ghost">Kijelentkez√©s</button>
      </div>
    </div>
    <div class="right">
      <div class="status" id="status">Kapcsolat: -</div>
    </div>
  </div>
  <div id="pwModal" style="display:none" aria-hidden="true" role="dialog" tabindex="-1">
    <div id="pwBox" role="document" tabindex="0">
      <h2 style="margin:0 0 8px">√çr√°s jelsz√≥val</h2>
      <div style="font-size:0.95rem;color:var(--muted);margin-bottom:10px">√çrd be a jelsz√≥t, hogy szerkeszthess.</div>
      <div class="password-container">
        <div class="password-inner">
          <input id="pwInput" type="password" autocomplete="off" placeholder="Jelsz√≥" />
          <span class="toggle-password" id="togglePassword" role="button" tabindex="0"></span>
        </div>
      </div>
      <div class="remember-container">
        <input type="checkbox" id="rememberMe">
        <label for="rememberMe">Eml√©kezz r√°m</label>
      </div>
      <div style="display:flex;gap:8px;justify-content:center;margin-top:12px">
        <button id="pwCancel" class="ghost">M√©gse</button>
        <button id="pwOk">Bejelentkez√©s</button>
      </div>
      <div class="error" id="pwNote">Helytelen jelsz√≥</div>
      <div class="info" id="pwInfo">Sikeres ‚Äî √≠r√°s enged√©lyezve</div>
      <small class="hint">Sz√≥k√∂z a beviteln√©l: a jelsz√≥ trim-elve lesz (v√©letlen sz√≥k√∂z√∂k elt√°vol√≠t√°sa).</small>
    </div>
  </div>
  <script type="module">
    const SUPABASE_URL = 'https://ccpuoqrbmldunshaxpes.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNjcHVvcXJibWxkdW5zaGF4cGVzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI1MTE2MDUsImV4cCI6MjA3ODA4NzYwNX0.QpVCmzF96Fp5hdgFyR0VkT9RV6qKiLkA8Yv_LArSk5I';
    const PASSWORD_HASH = '248e464b6e49676c615430dbfb831787d3d7c78e52bd2cb2461608991f7204f6';
    const TABLE = 'infosharer';
    const ID = 1;
    const REMEMBER_ME_KEY = 'infosharer_remember_token';
    const REMEMBER_DURATION = 365 * 24 * 60 * 60 * 1000;
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';
    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    const ta = document.getElementById('shared');
    const openPw = document.getElementById('openPw');
    const pwModal = document.getElementById('pwModal');
    const pwInput = document.getElementById('pwInput');
    const pwOk = document.getElementById('pwOk');
    const pwCancel = document.getElementById('pwCancel');
    const pwNote = document.getElementById('pwNote');
    const pwInfo = document.getElementById('pwInfo');
    const saveBtn = document.getElementById('saveBtn');
    const statusEl = document.getElementById('status');
    const copyBtn = document.getElementById('copyBtn');
    const authBtns = document.getElementById('authBtns');
    const togglePassword = document.getElementById('togglePassword');
    const rememberMe = document.getElementById('rememberMe');
    const logoutBtn = document.getElementById('logoutBtn');
    let canEdit = false;
    let channelRef = null;
    async function sha256hex(str){
      const enc = new TextEncoder().encode(str);
      const digest = await crypto.subtle.digest('SHA-256', enc);
      return Array.from(new Uint8Array(digest)).map(b=>b.toString(16).padStart(2,'0')).join('');
    }
    async function load(){
      try{
        const { data, error } = await supabase.from(TABLE).select('content').eq('id', ID).limit(1).single();
        if (error || !data) return;
        if (canEdit && document.activeElement === ta) return;
        const newContent = data.content || '';
        if (newContent !== ta.value) ta.value = newContent;
      }catch(err){
        console.error('Load error', err);
      }
    }
    async function upsert(text){
      try{
        await supabase.from(TABLE).upsert({ id: ID, content: text }, { onConflict: 'id' });
      }catch(err){
        console.error('Upsert error', err);
        alert('Ment√©s hiba (n√©zd a konzolt)');
      }
    }
    function setStatusFromState(state){
      let s = (state || '').toString().toLowerCase();
      if (s === 'closed' || s === 'megszakadt' || s === 'closedconnection') {
        s = 'megszakadt';
        statusEl.dataset.state = s;
        statusEl.textContent = 'Kapcsolat: megszakadt';
      } else {
        s = '√©l≈ë';
        statusEl.dataset.state = s;
        statusEl.textContent = 'Kapcsolat: √©l≈ë';
      }
    }
    function subscribeRealtime(){
      try{
        const channelName = 'public:' + TABLE;
        channelRef = supabase.channel(channelName).on('postgres_changes', { event: '*', schema: 'public', table: TABLE, filter: `id=eq.${ID}` }, payload=>{
          const row = payload?.new;
          if (row){
            if (!(canEdit && document.activeElement === ta)){
              ta.value = row.content || '';
            }
          }
        });
        const sub = channelRef.subscribe((statusOrObj)=>{
          try{
            if (!statusOrObj) {
              setStatusFromState('ismeretlen');
            } else if (typeof statusOrObj === 'string'){
              const normalized = statusOrObj === 'SUBSCRIBED' ? '√©l≈ë' : (statusOrObj === 'CLOSED' ? 'megszakadt' : statusOrObj);
              setStatusFromState(normalized);
            } else if (typeof statusOrObj === 'object'){
              const s = statusOrObj.status || statusOrObj;
              const normalized = (s === 'SUBSCRIBED') ? '√©l≈ë' : ((s === 'CLOSED') ? 'megszakadt' : s);
              setStatusFromState(normalized);
            } else {
              setStatusFromState(String(statusOrObj));
            }
          }catch(e){
            setStatusFromState('megszakadt');
          }
        });
        sub.on('error', (err)=>{
          setStatusFromState('megszakadt');
        });
      }catch(err){
        setStatusFromState('megszakadt');
      }
    }
    // Kezdeti √°llapot be√°ll√≠t√°sa
    togglePassword.style.backgroundImage = 'url("assets/images/view.png")';
    
    togglePassword.addEventListener('click', function() {
      const isPassword = pwInput.type === 'password';
      pwInput.type = isPassword ? 'text' : 'password';
      this.style.backgroundImage = isPassword ? 'url("assets/images/hide.png")' : 'url("assets/images/view.png")';
    });
    function setRememberToken() {
      const token = {
        value: PASSWORD_HASH,
        expires: Date.now() + REMEMBER_DURATION
      };
      localStorage.setItem(REMEMBER_ME_KEY, JSON.stringify(token));
    }
    function checkRememberMe() {
      const stored = localStorage.getItem(REMEMBER_ME_KEY);
      if (!stored) return false;
      try {
        const token = JSON.parse(stored);
        if (token.value === PASSWORD_HASH && token.expires > Date.now()) {
          return true;
        }
      } catch (e) {
        console.error('Hib√°s remember token:', e);
      }
      localStorage.removeItem(REMEMBER_ME_KEY);
      return false;
    }
    logoutBtn.addEventListener('click', function() {
      localStorage.removeItem(REMEMBER_ME_KEY);
      canEdit = false;
      ta.readOnly = true;
      saveBtn.disabled = true;
      authBtns.style.display = 'none';
      openPw.style.display = 'block';
      try {
        if (channelRef && typeof channelRef.unsubscribe === 'function') {
          channelRef.unsubscribe();
        }
      } catch (e) {
        console.warn('unsubscribe error', e);
      }
      channelRef = null;
      setStatusFromState('√©l≈ë');
      statusEl.textContent = 'Kapcsolat: -';
    });
    document.addEventListener('DOMContentLoaded', ()=>{
      pwModal.style.display = 'none';
      pwModal.setAttribute('aria-hidden', 'true');
      ta.readOnly = true;
      saveBtn.disabled = true;
      if (checkRememberMe()) {
        canEdit = true;
        ta.readOnly = false;
        saveBtn.disabled = false;
        openPw.style.display = 'none';
        authBtns.style.display = 'flex';
      }
      openPw.addEventListener('click', ()=>{
        pwNote.style.display = 'none';
        pwInfo.style.display = 'none';
        pwModal.style.display = 'flex';
        pwModal.setAttribute('aria-hidden', 'false');
        pwInput.value = '';
        pwInput.type = 'password';
        togglePassword.style.backgroundImage = 'url("assets/images/view.png")';
        setTimeout(()=> pwInput.focus(), 50);
      });
      // Modal bez√°r√°s kezel≈ë f√ºggv√©ny
      const closeModal = () => {
        pwModal.style.display = 'none';
        pwModal.setAttribute('aria-hidden', 'true');
        pwInput.value = '';
        pwNote.style.display = 'none';
        pwInput.type = 'password';
        togglePassword.style.backgroundImage = 'url("assets/images/view.png")';
        rememberMe.checked = false;
      };

      // M√©gse gomb kezel√©se
      pwCancel.addEventListener('click', closeModal);

      // ESC billenty≈± kezel√©se
      pwModal.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          e.preventDefault();
          closeModal();
        }
      });

      // F√≥kusz kezel√©s
      pwModal.addEventListener('keydown', (e) => {
        if (e.key === 'Tab') {
          const focusableElements = pwBox.querySelectorAll('input, button, [tabindex="0"]');
          const firstElement = focusableElements[0];
          const lastElement = focusableElements[focusableElements.length - 1];

          if (e.shiftKey) { // Shift+Tab
            if (document.activeElement === firstElement) {
              e.preventDefault();
              lastElement.focus();
            }
          } else { // Tab
            if (document.activeElement === lastElement) {
              e.preventDefault();
              firstElement.focus();
            }
          }
        }
      });
      pwModal.addEventListener('mousedown', (e)=>{
        // Csak akkor z√°rjuk be, ha pontosan a modal h√°tt√©rre (overlay) kattintottunk
        if (e.target === pwModal && e.button === 0) {
          e.preventDefault();
          pwCancel.click();
        }
      });
      pwInput.addEventListener('keydown', (e)=>{ if (e.key === 'Enter') { e.preventDefault(); pwOk.click(); } });
      pwOk.addEventListener('click', async ()=>{
        const raw = pwInput.value || '';
        const attempt = raw.trim();
        pwNote.style.display = 'none';
        try{
          const h = await sha256hex(attempt);
          document.dispatchEvent(new CustomEvent('infosharer:pwAttempt', { detail: { hash: h, raw: attempt } }));
        }catch(err){
          pwNote.textContent = 'Hiba a jelsz√≥ellen≈ërz√©sn√©l';
          pwNote.style.display = 'block';
        }
      });
      saveBtn.addEventListener('click', async ()=>{
        if (!canEdit) { alert('El≈ëbb enged√©lyezd az √≠r√°st jelsz√≥val.'); return; }
        saveBtn.textContent = 'Ment√©s...';
        saveBtn.disabled = true;
        await upsert(ta.value);
        saveBtn.textContent = '‚úÖ Mentve';
        setTimeout(()=> { saveBtn.textContent = 'Ment√©s'; saveBtn.disabled = false; }, 900);
      });
      copyBtn.addEventListener('click', async ()=>{
        try{
          await navigator.clipboard.writeText(ta.value);
          const old = copyBtn.textContent;
          copyBtn.textContent = '‚úÖ M√°solva';
          setTimeout(()=> { copyBtn.textContent = old; }, 900);
        }catch(err){
          alert('M√°sol√°s sikertelen');
        }
      });
    });
    document.addEventListener('infosharer:pwAttempt', (ev)=>{
      try{
        const sentHash = (ev?.detail?.hash || '').toLowerCase();
        if (!PASSWORD_HASH || PASSWORD_HASH.length === 0 || PASSWORD_HASH === 'replace_with_sha256_hex_of_password'){
          document.dispatchEvent(new CustomEvent('infosharer:authFail', { detail: { message: 'A szerver nincs konfigur√°lva (PASSWORD_HASH hi√°nyzik).' } }));
          return;
        }
        if (sentHash === PASSWORD_HASH.toLowerCase()){
          document.dispatchEvent(new CustomEvent('infosharer:authSuccess'));
          canEdit = true;
          saveBtn.disabled = false;
          setTimeout(()=> ta.focus(), 50);
        }else{
          document.dispatchEvent(new CustomEvent('infosharer:authFail', { detail: { message: 'Helytelen jelsz√≥' } }));
        }
      }catch(err){
        document.dispatchEvent(new CustomEvent('infosharer:authFail', { detail: { message: 'Hiba' } }));
      }
    });
    document.addEventListener('infosharer:authSuccess', ()=>{
      pwModal.style.display = 'none';
      pwModal.setAttribute('aria-hidden', 'true');
      pwInput.value = '';
      pwNote.style.display = 'none';
      pwInfo.style.display = 'block';
      setTimeout(()=> pwInfo.style.display = 'none', 1200);
      ta.readOnly = false;
      openPw.style.display = 'none';
      authBtns.style.display = 'flex';
      if (rememberMe.checked) {
        setRememberToken();
      }
      rememberMe.checked = false;
    });
    document.addEventListener('infosharer:authFail', (e)=>{
      pwNote.textContent = e?.detail?.message || 'Helytelen jelsz√≥';
      pwNote.style.display = 'block';
    });
    (async function init(){
      await load();
      subscribeRealtime();
      const REFRESH_INTERVAL = 1000;
      setInterval(async ()=>{
        try{
          if (canEdit && document.activeElement === ta) return;
          await load();
          const t = new Date();
          const hh = t.getHours().toString().padStart(2,'0');
          const mm = t.getMinutes().toString().padStart(2,'0');
          const ss = t.getSeconds().toString().padStart(2,'0');
          const stamp = hh + ':' + mm + ':' + ss;
          const currentState = statusEl.dataset.state || 'ismeretlen';
          statusEl.textContent = 'Kapcsolat: friss√≠tve ' + stamp;
          if (currentState) {
            statusEl.dataset.state = currentState;
          }
        }catch(e){
          console.error(e);
        }
      }, REFRESH_INTERVAL);
    })();
  </script>
</body>
<script src="assets/js/footer.js"></script>
</html>
