<!DOCTYPE html>
<html lang="hu">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content="Infosharer - Biztons√°gos f√°jlmegoszt√≥ √©s sz√∂vegszerkeszt≈ë platform. Ossz meg f√°jlokat √©s inform√°ci√≥kat val√≥s idej≈± szinkroniz√°ci√≥val, 50 MB t√°rhellyel √©s egyedi megoszt√°si linkekkel." />
    <meta property="og:image" content="https://xxhaltiruxx.github.io/agazati/assets/images/og.webp" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:image:type" content="image/png" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:image" content="https://xxhaltiruxx.github.io/agazati/assets/images/og.webp" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <base href="../../" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link
      rel="shortcut icon"
      href="assets/images/agazati.ico"
      type="image/x-icon"
    />
    <link rel="stylesheet" href="./assets/css/base.css" />
    <link rel="stylesheet" href="assets/css/main.css" />
    <link rel="stylesheet" href="assets/css/nav.css" />
    <link rel="stylesheet" href="assets/css/utilities.css" />
    <link rel="stylesheet" href="assets/css/footer.css" />
    <link rel="stylesheet" href="assets/css/infosharer.css" />
    
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
    <script src="assets/js/admin-guard.js"></script>
    <title>Infosharer</title>
  </head>
  <body>
    <div id="mySidenav" class="sidenav"></div>
    <h2 class="cim subsite">Infosharer</h2>
    <div class="meta">
      Az oldal alapb√≥l csak olvashat√≥. Kattints az
      <strong>√çr√°s enged√©lyez√©se</strong>-re, add meg a jelsz√≥t, majd szerkeszd
      √©s mentsd.
    </div>
    <textarea id="shared" readonly placeholder="Bet√∂lt√©s..."></textarea>

    <div class="controls">
      <div class="left">
        <div class="mainBtns">
          <button id="openPw" class="secondary">√çr√°s enged√©lyez√©se</button>
          <button id="copyBtn" class="ghost">M√°sol√°s</button>
        </div>
        <div class="authBtns" id="authBtns" style="display: none">
          <button id="saveBtn" class="ghost" disabled>Ment√©s</button>
          <button id="copyBtn2" class="ghost">M√°sol√°s</button>
          <button id="logoutBtn" class="ghost">Kijelentkez√©s</button>
        </div>
      </div>
      <div class="right">
        <div class="status" id="status">Kapcsolat: -</div>
      </div>
    </div>

    <!-- F√°jl felt√∂lt√©s √©s slotok -->
    <div class="container mt-5" style="max-width: 1200px">
      <div class="row mb-4">
        <div class="col-12">
          <h3 class="text-center mb-4" style="color: var(--text)">
            F√°jl Slots
          </h3>
          <div class="meta mb-4">
            Mindenki let√∂ltheti a f√°jlokat. Csak bejelentkezett felhaszn√°l√≥k
            t√∂lthetnek fel √©s t√∂r√∂lhetnek f√°jlokat.
            <br /><span
              id="filesStatus"
              style="color: var(--muted); font-size: 0.9em"
              >F√°jlok bet√∂lt√©se...</span
            >
            <br />
            <div style="margin-top: 12px; padding: 10px; background: rgba(127, 90, 240, 0.1); border-radius: 8px; max-width: 400px; margin-left: auto; margin-right: auto;">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px;">
                <span style="color: var(--text); font-weight: 500; font-size: 0.9em;">√ñsszesen:</span>
                <span id="totalStorageDisplay" style="color: var(--accent-light); font-weight: bold; font-size: 0.9em;">0 MB / 50 MB</span>
              </div>
              <div style="height: 6px; background: #16162a; border-radius: 3px; overflow: hidden;">
                <div id="totalStorageBar" style="height: 100%; background: linear-gradient(90deg, var(--accent), var(--accent-light)); width: 0%; transition: width 0.3s ease;"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- F√°jl slotok grid -->
      <div class="row" id="slotContainer">
        <!-- Slotok itt j√∂nnek l√©tre dinamikusan -->
      </div>

      <!-- F√°jl felt√∂lt√©s modal -->
      <div class="modal fade" id="uploadModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
          <div
            class="modal-content"
            style="background: var(--bg-mid); border: 1px solid var(--accent)"
          >
            <div
              class="modal-header"
              style="border-bottom: 1px solid var(--accent)"
            >
              <h5 class="modal-title" style="color: var(--text); white-space: nowrap;">
                <span id="modalSlotTitle">Slot 1</span>
              </h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
                style="filter: invert(1)"
              ></button>
            </div>
            <div class="modal-body">
              <!-- T√°rhelyhaszn√°lat kijelz≈ë -->
              <div class="mb-3" id="storageInfo" style="
                background: rgba(127, 90, 240, 0.1);
                border: 1px solid var(--accent);
                border-radius: 8px;
                padding: 12px;
              ">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                  <span style="color: var(--text); font-weight: 500;">T√°rhelyhaszn√°lat</span>
                  <span id="storageText" style="color: var(--accent-light); font-weight: bold;">0 MB / 50 MB</span>
                </div>
                <div style="
                  height: 8px;
                  background: #16162a;
                  border-radius: 4px;
                  overflow: hidden;
                ">
                  <div id="storageBar" style="
                    height: 100%;
                    background: linear-gradient(90deg, var(--accent), var(--accent-light));
                    width: 0%;
                    transition: width 0.3s ease;
                  "></div>
                </div>
                <div style="color: var(--muted); font-size: 0.85rem; margin-top: 4px;">
                  Szabad hely: <span id="freeSpace" style="color: var(--success);">50 MB</span>
                </div>
              </div>

              <!-- Drag & Drop f√°jl felt√∂lt√©s -->
              <div class="mb-3">
                <label class="form-label" style="color: var(--text); font-weight: 500;">
                  V√°lassz f√°jlt vagy h√∫zd ide
                </label>
                <div id="dropZone" style="
                  border: 2px dashed var(--accent);
                  border-radius: 12px;
                  padding: 40px 20px;
                  text-align: center;
                  background: rgba(127, 90, 240, 0.05);
                  cursor: pointer;
                  transition: all 0.3s ease;
                  position: relative;
                ">
                  <input
                    class="form-control"
                    type="file"
                    id="fileUploadInput"
                    style="display: none;"
                  />
                  <div id="dropZoneContent">
                    <div style="font-size: 3rem; margin-bottom: 10px; color: var(--accent);">‚¨Ü</div>
                    <div style="color: var(--text); font-weight: 500; margin-bottom: 8px;">
                      Kattints vagy h√∫zd ide a f√°jlt
                    </div>
                    <div style="color: var(--muted); font-size: 0.9rem;">
                      Maxim√°lis f√°jlm√©ret: 50 MB
                    </div>
                  </div>
                </div>
              </div>
              <div
                id="fileInfo"
                style="
                  display: none;
                  padding: 10px;
                  background: rgba(127, 90, 240, 0.1);
                  border-radius: 6px;
                  margin-bottom: 15px;
                "
              >
                <div style="color: var(--text)">
                  <strong>Kiv√°lasztott f√°jl:</strong>
                  <span id="selectedFileName"></span>
                </div>
                <div style="color: var(--muted)" id="selectedFileSize"></div>
              </div>
              <div id="uploadProgress" style="display: none">
                <div
                  class="progress"
                  style="
                    height: 8px;
                    background: #16162a;
                    border-radius: 4px;
                    overflow: hidden;
                  "
                >
                  <div
                    id="uploadProgressBar"
                    class="progress-bar"
                    role="progressbar"
                    style="background: var(--accent); width: 0%"
                  ></div>
                </div>
                <div
                  id="uploadProgressText"
                  class="text-center mt-2"
                  style="color: var(--muted)"
                >
                  Felt√∂lt√©s...
                </div>
              </div>
            </div>
            <div
              class="modal-footer"
              style="border-top: 1px solid var(--accent)"
            >
              <button type="button" class="btn ghost" data-bs-dismiss="modal">
                M√©gse
              </button>
              <button type="button" class="btn secondary" id="confirmUpload">
                Felt√∂lt√©s
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- F√°jl inform√°ci√≥k modal -->
      <div class="modal fade" id="fileInfoModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content" style="background: var(--bg-mid); border: 1px solid var(--accent)">
            <div class="modal-header" style="border-bottom: 1px solid var(--accent)">
              <h5 class="modal-title" style="color: var(--text); white-space: nowrap;">
                <span id="infoModalSlotTitle">Slot 1</span>
              </h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" style="filter: invert(1)"></button>
            </div>
            <div class="modal-body">
              <!-- F√°jl el≈ën√©zet / Ikon -->
              <div id="filePreviewSection" class="text-center mb-4" style="display: none;">
                <img id="filePreviewImage" style="max-width: 100%; max-height: 200px; border-radius: 8px; margin: 0 auto 10px auto; display: none;" />
              </div>
              <div id="fileIconSection" class="text-center mb-4" style="display: none;">
                <div id="fileIconLarge" style="font-size: 4rem; margin-bottom: 10px;">üìÑ</div>
              </div>

              <!-- F√°jl r√©szletek -->
              <div style="background: rgba(127, 90, 240, 0.1); border: 1px solid var(--accent); border-radius: 8px; padding: 15px; margin-bottom: 15px;">
                <div style="display: grid; gap: 12px;">
                  <div>
                    <span style="color: var(--muted); font-size: 0.9em;">F√°jln√©v:</span>
                    <div id="infoFileName" style="color: var(--text); font-weight: 500; word-break: break-all;"></div>
                  </div>
                  <div>
                    <span style="color: var(--muted); font-size: 0.9em;">M√©ret:</span>
                    <div id="infoFileSize" style="color: var(--accent-light); font-weight: 500;"></div>
                  </div>
                  <div>
                    <span style="color: var(--muted); font-size: 0.9em;">Felt√∂ltve:</span>
                    <div id="infoFileDate" style="color: var(--text);"></div>
                  </div>
                </div>
              </div>

              <!-- Link gener√°l√°s √©s m√°sol√°s -->
              <div style="background: rgba(127, 90, 240, 0.05); border: 1px solid var(--accent); border-radius: 8px; padding: 15px;">
                <h6 style="color: var(--accent-light); margin-bottom: 12px;">Megoszthat√≥ Link</h6>
                
                <div class="mb-3">
                  <label for="linkExpirySelect" class="form-label" style="color: var(--text); font-size: 0.9em;">Link √©rv√©nyess√©ge:</label>
                  <select id="linkExpirySelect" class="form-select" style="background: var(--bg-dark); color: var(--text); border: 1px solid var(--accent);">
                    <option value="3600">1 √≥ra</option>
                    <option value="21600">6 √≥ra</option>
                    <option value="86400" selected>24 √≥ra (1 nap)</option>
                    <option value="259200">3 nap</option>
                    <option value="604800">7 nap (1 h√©t)</option>
                  </select>
                </div>

                <button id="generateLinkBtn" class="btn w-100 mb-2" style="background: var(--accent); color: white; font-weight: 500;">
                  üîó Link gener√°l√°sa
                </button>

                <div id="generatedLinkSection" style="display: none;">
                  <div style="background: var(--bg-dark); border: 1px solid var(--accent); border-radius: 6px; padding: 15px; text-align: center;">
                    <div style="color: var(--muted); font-size: 0.85em; margin-bottom: 10px;">Link automatikusan v√°g√≥lapra m√°solva:</div>
                    <div id="generatedLinkDisplay" style="color: var(--accent-light); font-size: 0.95em; font-family: monospace; word-break: break-all; padding: 10px; background: rgba(127, 90, 240, 0.1); border-radius: 6px; margin-bottom: 10px;"></div>
                    <div style="color: var(--success); font-size: 0.85em;">
                      √ârv√©nyes: <span id="linkExpiryText"></span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="modal-footer" style="border-top: 1px solid var(--accent); gap: 8px;">
              <button id="infoDownloadBtn" class="btn" style="background: var(--accent); color: white; flex: 1;">
                Let√∂lt√©s
              </button>
              <button id="infoDeleteBtn" class="btn ghost" style="color: var(--error); border-color: var(--error); flex: 1;" data-requires-auth="true">
                T√∂rl√©s
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- F√°jl t√∂rl√©s meger≈ës√≠t√©s modal -->
      <div class="modal fade" id="deleteModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
          <div
            class="modal-content"
            style="background: var(--bg-mid); border: 1px solid var(--accent)"
          >
            <div
              class="modal-header"
              style="border-bottom: 1px solid var(--accent)"
            >
              <h5 class="modal-title" style="color: var(--text)">
                F√°jl t√∂rl√©se
              </h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
                style="filter: invert(1)"
              ></button>
            </div>
            <div class="modal-body">
              <p style="color: var(--text)">
                Biztosan t√∂r√∂lni szeretn√©d ezt a f√°jlt?
              </p>
              <p
                id="deleteFileName"
                style="
                  color: var(--accent-light);
                  font-weight: bold;
                  word-break: break-all;
                "
              ></p>
            </div>
            <div
              class="modal-footer"
              style="border-top: 1px solid var(--accent)"
            >
              <button type="button" class="btn ghost" data-bs-dismiss="modal">
                M√©gse
              </button>
              <button
                type="button"
                class="btn"
                id="confirmDelete"
                style="background: var(--error); color: white"
              >
                T√∂rl√©s
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- √öj Supabase Auth Modal bet√∂lt√©se -->
    <div id="authModalContainer"></div>

    <!-- St√≠lusok a slot k√°rty√°khoz -->
    <style>
      .card {
        transition: all 0.3s ease;
      }

      .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 25px rgba(127, 90, 240, 0.3) !important;
      }
      
      /* K√©p el≈ën√©zet anim√°ci√≥k */
      .card img {
        transition: transform 0.3s ease;
      }
      
      .card:hover img {
        transform: scale(1.05);
      }

      .btn {
        transition: all 0.2s ease;
        border-radius: 8px;
        padding: 0.5rem 1rem;
      }

      .btn:hover {
        transform: translateY(-2px);
      }

      .modal-content {
        border-radius: 12px;
      }

      .form-control {
        background: #16162a;
        color: var(--text);
        border: 1px solid var(--accent);
        border-radius: 8px;
        padding: 0.75rem;
      }

      .form-control:focus {
        background: #16162a;
        color: var(--text);
        border-color: var(--accent-light);
        box-shadow: 0 0 0 0.25rem rgba(127, 90, 240, 0.25);
      }

      .form-label {
        font-weight: 500;
        margin-bottom: 0.5rem;
      }

      .form-text {
        font-size: 0.875rem;
        margin-top: 0.25rem;
      }

      /* Responsive design */
      @media (max-width: 768px) {
        .col-md-3 {
          flex: 0 0 50%;
          max-width: 50%;
        }
      }

      @media (max-width: 576px) {
        .col-md-3,
        .col-sm-6 {
          flex: 0 0 100%;
          max-width: 100%;
        }

        .card-body {
          padding: 1.25rem;
        }
      }
    </style>

    <script type="module" src="assets/js/infosharer.js"></script>
    <script src="assets/js/nav.js"></script>
    <script src="assets/js/footer.js"></script>
    
    <script>
      // Folyamatos admin st√°tusz ellen≈ërz√©s
      function setupAdminProtection() {
        // Figyelj√ºk a login state v√°ltoz√°sokat
        window.addEventListener('loginStateChanged', (event) => {
          const { loggedIn, isAdmin } = event.detail;
          
          // Ha elvesztett√ºk az admin jogot vagy kijelentkezt√ºnk
          if (!loggedIn || !isAdmin) {
            alert('‚õî Az admin jogosults√°god v√°ltozott!\n\nVisszair√°ny√≠tunk a f≈ëoldalra.');
            const baseUrl = window.location.pathname.includes('/agazati/') ? '/agazati/' : '/';
            window.location.href = baseUrl;
          }
        });
        
        // Rendszeres admin check (5 m√°sodpercenk√©nt)
        setInterval(() => {
          const auth = window.getAuth ? window.getAuth() : null;
          if (!auth || !auth.isAuthenticated() || !auth.isAdminUser()) {
            const baseUrl = window.location.pathname.includes('/agazati/') ? '/agazati/' : '/';
            window.location.href = baseUrl;
          }
        }, 5000);
      }
      
      // Inicializ√°l√°s
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', setupAdminProtection);
      } else {
        setupAdminProtection();
      }
    </script>
  </body>
</html>
